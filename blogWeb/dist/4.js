(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{265:function(t,e,a){var o=a(49);t.exports=function(t){return Object(o(t))}},301:function(t,e,a){var o=a(48);t.exports=Array.isArray||function(t){return"Array"==o(t)}},302:function(t,e,a){"use strict";var o=a(33),n=a(139),r=a(51),s=a(89),i=a(265),c=a(303),h=a(304),l=a(305),d=a(266),u=l("splice"),f=d("splice",{ACCESSORS:!0,0:0,1:2}),g=Math.max,p=Math.min;o({target:"Array",proto:!0,forced:!u||!f},{splice:function(t,e){var a,o,l,d,u,f,v=i(this),m=s(v.length),y=n(t,m),b=arguments.length;if(0===b?a=o=0:1===b?(a=0,o=m-y):(a=b-2,o=p(g(r(e),0),m-y)),m+a-o>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(v,o),d=0;d<o;d++)(u=y+d)in v&&h(l,d,v[u]);if(l.length=o,a<o){for(d=y;d<m-o;d++)f=d+a,(u=d+o)in v?v[f]=v[u]:delete v[f];for(d=m;d>m-o+a;d--)delete v[d-1]}else if(a>o)for(d=m-o;d>y;d--)f=d+a-1,(u=d+o-1)in v?v[f]=v[u]:delete v[f];for(d=0;d<a;d++)v[d+y]=arguments[d+2];return v.length=m-o+a,l}})},303:function(t,e,a){var o=a(25),n=a(301),r=a(13)("species");t.exports=function(t,e){var a;return n(t)&&("function"!=typeof(a=t.constructor)||a!==Array&&!n(a.prototype)?o(a)&&null===(a=a[r])&&(a=void 0):a=void 0),new(void 0===a?Array:a)(0===e?0:e)}},304:function(t,e,a){"use strict";var o=a(88),n=a(26),r=a(87);t.exports=function(t,e,a){var s=o(e);s in t?n.f(t,s,r(0,a)):t[s]=a}},305:function(t,e,a){var o=a(11),n=a(13),r=a(267),s=n("species");t.exports=function(t){return r>=51||!o((function(){var e=[];return(e.constructor={})[s]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},511:function(t,e,a){a(33)({target:"Array",stat:!0},{isArray:a(301)})},512:function(t,e,a){"use strict";var o=a(1),n=a.n(o)()((function(t){return t[1]}));n.push([t.i,".chat-list[data-v-a1e9fda8]{height:784px;overflow:auto}.chat-list .el-button[data-v-a1e9fda8]{width:100%;text-align:left;padding:10px 0}.chat-list .el-badge[data-v-a1e9fda8]{height:40px;width:80px;vertical-align:top}.chat-list .el-badge .name[data-v-a1e9fda8]{font-weight:bolder;margin-bottom:10px}.chat-list .el-badge .content[data-v-a1e9fda8]{color:silver}.chat-record-content[data-v-a1e9fda8]{height:500px;overflow:auto;border:2px solid #f4f5f6;padding:20px;margin:20px 0}.chat-record-content .el-row[data-v-a1e9fda8]{margin:10px 0}.chat-record-content .time[data-v-a1e9fda8]{text-align:center;font-size:12px;color:silver}.chat-record-content #message[data-v-a1e9fda8]{box-sizing:border-box;margin:0 10px;min-height:40px;max-width:40%;background-color:#409eff;padding:10px;border-radius:10px;word-wrap:break-word}.chat-record-content[data-v-a1e9fda8]::-webkit-scrollbar{width:10px;height:1px}.chat-record-content[data-v-a1e9fda8]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 5px rgba(0,0,0,.2);background-color:rgba(144,147,153,.3)}.tips[data-v-a1e9fda8]{margin-right:20px;color:silver;line-height:40px;font-size:12px}[data-v-a1e9fda8] textarea::-webkit-scrollbar{width:10px;height:1px}[data-v-a1e9fda8] textarea::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 5px rgba(0,0,0,.2);background-color:rgba(144,147,153,.3)}.el-scrollbar__wrap[data-v-a1e9fda8]{overflow-x:hidden}.el-scrollbar[data-v-a1e9fda8]  .el-scrollbar__wrap{overflow-x:hidden}",""]),e.a=n},518:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tabs",{on:{"tab-click":t.changeTab},model:{value:t.checkedTab,callback:function(e){t.checkedTab=e},expression:"checkedTab"}},[a("el-tab-pane",{attrs:{label:"回复我的",name:"1"}},[t._v("待开发")]),t._v(" "),a("el-tab-pane",{attrs:{label:"收到的赞",name:"2"}},[t._v("待开发")]),t._v(" "),a("el-tab-pane",{attrs:{label:"私信",name:"3",lazy:""}},[a("ChatList")],1)],1)};o._withStripped=!0;a(251);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{staticClass:"chat-list",attrs:{span:6}},t._l(t.chats,(function(e,o){return a("el-row",{key:o},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.chat(e.key,o)}}},[a("el-avatar",{attrs:{src:e.avatar}}),t._v(" "),a("el-badge",{attrs:{value:e.unread?e.unread:""}},[a("div",{staticClass:"name"},[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(e.last&&e.last.content))])])],1)],1)})),1),t._v(" "),a("el-col",{attrs:{span:18}},[a("div",[t._v("标题")]),t._v(" "),a("v-infinite-scroll",{staticClass:"chat-record-content",attrs:{loading:t.loadingChatRecord.isLoading,onTopScrollsToBottom:!1},on:{top:t.loadChatRecord}},[t.loadingChatRecord.noMore?a("el-divider",[t._v("没有更多了")]):t._e(),t._v(" "),t.loadingChatRecord.loading?a("el-divider",[t._v("加载中...")]):t._e(),t._v(" "),t._l(t.chatContent,(function(e,o){return a("el-row",{key:o},[a("div",{staticClass:"time"},[t._v(" "+t._s(t._f("chatTime")(e.time)))]),t._v(" "),a("el-avatar",{style:{float:t.float[e.sender]},attrs:{id:"avatar",src:t.user[e.sender].avatar}}),t._v(" "),a("span",{style:{float:t.float[e.sender]},attrs:{id:"message"}},[t._v(t._s(e.content))])],1)}))],2),t._v(" "),a("el-row",[a("el-form",{ref:"form",attrs:{model:t.chatMsgForm,rules:t.rules}},[a("el-form-item",{attrs:{prop:"content"}},[a("el-input",{attrs:{type:"textarea",rows:"5",resize:"none",maxlength:"500",disabled:!t.$route.query.key},model:{value:t.chatMsgForm.content,callback:function(e){t.$set(t.chatMsgForm,"content",e)},expression:"chatMsgForm.content"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("span",{staticClass:"tips"},[t._v(t._s(t.chatMsgForm.content.length)+"/500")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.sendMessage}},[t._v("发送")])],1)],1)],1)],1)};n._withStripped=!0;a(511),a(302),a(252),a(53);var r=a(47);function s(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}var c={mixins:[a(253).a],data:function(){var t=this;return{chats:[],ws:null,loadingChatRecord:{loading:!1,isLoading:!1,noMore:!1,page:1,pageSize:10},chatContent:[],float:{slef:"right",other:"left"},elContent:"",user:{slef:"",other:""},chatMsgForm:{from:"",to:"",type:"chat",content:""},rules:{content:{validator:function(e,a,o){t.chatMsgForm.content?o():o(new Error("消息不能为空"))},trigger:"blur"}}}},methods:{chat:function(t,e){this.$router.push({path:"/interaction",query:{tab:3,key:t}}),this.chats[e].unread=0},onOpen:function(){this.$message({type:"success",message:"已进入聊天室"})},onClose:function(){this.$message({type:"waring",message:"已退出聊天室"})},onError:function(t){this.ws=new WebSocket("wss://shop.weiaiyanyan.com/chat?key="+t),this.$message({type:"danger",message:"连接失败，重连中..."})},onMessage:function(t){var e=this,a=JSON.parse(t.data);if(a.from===this.chatMsgForm.to)for(var o in this.chatContent.push({content:a.content,sender:"other",time:new Date}),this.$nextTick((function(){e.elContent.scrollTop=e.elContent.scrollHeight})),this.chats)a.from===this.chats[o].to&&(this.chats[o].last.content=a.content,this.chats.unshift(this.chats.splice(o,1)[0]));else{var n=!1;for(var s in this.chats)a.from===this.chats[s].to&&(this.chats[s].unread++,this.chats[s].last.content=a.content,this.chats.unshift(this.chats.splice(s,1)[0]),n=!0);n||r.a.getOtherUserInfo({key:a.from}).then((function(t){var o=t.data;console.log(o),o.status&&e.chats.unshift({to:a.from,avatar:o.data.avatar,key:o.data.key,last:{sender:"other",content:a.content},name:o.data.name,unread:1})}))}},initWebSocket:function(t){this.ws=new WebSocket("wss://shop.weiaiyanyan.com/chat?key="+t),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("close",this.onClose),this.ws.addEventListener("error",this.onError,t),this.heartCheck(t)},heartCheck:function(t){var e=this;setInterval((function(){console.log("再也不掉线了"),1===e.ws.readyState?e.ws.send(JSON.stringify({message:"ping"})):e.initWebSocket(t)}),56e3)},sendMessage:function(){var t=this;this.$refs.form.validate((function(e){if(e){console.log(t.chatMsgForm);var a={record:t.chatMsgForm};r.a.sendMessage(a).then((function(e){var a=e.data;console.log(a),t.chatContent.push({content:t.chatMsgForm.content,sender:"slef",time:new Date}),t.ws.send(JSON.stringify(t.chatMsgForm)),t.$nextTick((function(){t.elContent.scrollTop=t.elContent.scrollHeight,t.chatMsgForm.content=""}))}))}}))},getChatRecord:function(t){var e=this,a={key:t};r.a.getChatRecord(a).then((function(t){var a=t.data;console.log(a),a.status?(e.user.other=a.data.chats.to,e.user.slef=a.data.chats.from,e.chatMsgForm.to=a.data.chats.to.key,e.chatMsgForm.from=a.data.chats.from.key,e.chatContent=a.data.chats.record,e.$nextTick((function(){e.elContent.scrollTop=e.elContent.scrollHeight}))):(e.chats.unshift(a.data.chats.to),e.user.other=a.data.chats.to,e.user.slef=a.data.chats.from,e.chatMsgForm.to=a.data.chats.to.key,e.chatMsgForm.from=a.data.chats.from.key)}))},getChatList:function(){var t=this,e={};this.$route.query.key&&(e.key=this.$route.query.key),r.a.getChatList(e).then((function(e){var a=e.data;console.log(a),a.status&&(t.chats=a.data.chats)}))},loadChatRecord:function(){var t=this;console.log(1),this.loadingChatRecord.loading=!0,this.loadingChatRecord.isLoading=!0;var e={key:this.$route.query.key,page:++this.loadingChatRecord.page,pageSize:this.loadingChatRecord.pageSize};r.a.getChatRecord(e).then((function(e){var a=e.data;if(console.log(a),a.status){var o,n=t.elContent.scrollHeight;(o=t.chatContent).unshift.apply(o,s(a.data.chats.record)),t.$nextTick((function(){t.elContent.scrollTop=t.elContent.scrollHeight-n})),t.loadingChatRecord.loading=!1,t.loadingChatRecord.noMore=a.data.noMore||!1,t.loadingChatRecord.isLoading=a.data.noMore||!1}}))}},watch:{$route:function(t){t.query.key&&(this.getChatRecord(t.query.key),this.chatMsgForm.to=t.query.key)}},components:{},mounted:function(){this.elContent=document.querySelector(".chat-record-content"),this.getChatList(),this.initWebSocket(sessionStorage.getItem("key")),this.$route.query.key&&this.getChatRecord(this.$route.query.key),this.chatMsgForm.from=sessionStorage.getItem("key"),this.chatMsgForm.to=this.$route.query.key},beforeDestroy:function(){this.ws.close()}},h=a(2),l=a.n(h),d=a(512),u={insert:"head",singleton:!1},f=(l()(d.a,u),d.a.locals,a(4)),g=Object(f.a)(c,n,[],!1,null,"a1e9fda8",null);g.options.__file="src/pages/user/components/interaction/ChatList.vue";var p={data:function(){return{checkedTab:"1"}},watch:{$route:function(){this.checkedTab=this.$route.query.tab||"1"}},methods:{changeTab:function(t){this.$router.push("/interaction?tab="+t.name)}},components:{ChatList:g.exports},mounted:function(){this.checkedTab=this.$route.query.tab||"1",this.chat=this.$route.query.key||""}},v=Object(f.a)(p,o,[],!1,null,"1f6d5d28",null);v.options.__file="src/pages/user/components/interaction/Interaction.vue";e.default=v.exports}}]);